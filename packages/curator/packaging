#!/usr/bin/env bash

set -e

export PATH="/var/vcap/packages/python3/bin:${PATH}"
export LD_LIBRARY_PATH="/var/vcap/packages/python3/lib:${LD_LIBRARY_PATH}"
export C_INCLUDE_PATH="/var/vcap/packages/python3/include:${C_INCLUDE_PATH}"

# To download updated blobs for this package, see bin/download-wheels.sh. For example:
#
#  ./bin/download-wheels/curator_opensearch
#
# Then, add the downloaded blobs to the release:
#
#  ./bin/add-wheel-blobs.sh vendor/curator_opensearch curator_opensearch/vendor

# --no-index prevents contacting pypi to download packages
# --find-links tells pip where to look for the dependancies
# --prefix installation prefix where lib, bin and other top-level folders are placed

# pip3 install --no-index "--prefix=${BOSH_INSTALL_TARGET}" curator/vendor/flit_core-3.8.0.tar.gz
# pip3 install --no-index --find-links ./curator/vendor/ "--prefix=${BOSH_INSTALL_TARGET}" curator/vendor/wheel-0.41.2.tar.gz
# pip3 install --no-index --find-links ./curator/vendor/ "--prefix=${BOSH_INSTALL_TARGET}" curator/vendor/Cython-0.29.36.tar.gz
# pip3 install --no-index --find-links ./curator/vendor/ "--prefix=${BOSH_INSTALL_TARGET}" curator/vendor/PyYAML-6.0.1.tar.gz
# pip3 install --no-index --find-links ./curator/vendor/ "--prefix=${BOSH_INSTALL_TARGET}" curator_opensearch-0.0.12-py2.py3-none-any.whl

python3 -m pip install "--prefix=${BOSH_INSTALL_TARGET}" --no-index curator_opensearch/vendor/*.whl
tar xzvf curator_opensearch-0.0.13.tar.gz -C "$BOSH_INSTALL_TARGET" --strip-components 1
