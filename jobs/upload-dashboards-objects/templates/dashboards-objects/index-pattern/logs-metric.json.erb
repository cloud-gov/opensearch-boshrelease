<%

require 'json'

fields_json =
    [
            {
                "count": 0,
                "name": "@cf.app",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.app_id",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@cf.app_instance",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.instance",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.instance_id",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.org",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.org_id",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.plan_id",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.process_id",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@cf.process_instance_id",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@cf.process_type",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@cf.service",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.service_instance_id",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.service_offering",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.service_plan",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.space",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@cf.space_id",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@index_type",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@input",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@level",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@raw",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@shipper",
                "type": "unknown",
                "esTypes": [
                    "flat_object"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@source",
                "type": "unknown",
                "esTypes": [
                    "flat_object"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@timestamp",
                "type": "date",
                "esTypes": [
                    "date"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "@type",
                "type": "string",
                "esTypes": [
                    "match_only_text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "@version",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "_id",
                "type": "string",
                "esTypes": [
                    "_id"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "_index",
                "type": "string",
                "esTypes": [
                    "_index"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "_score",
                "type": "number",
                "scripted": false,
                "searchable": false,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "_source",
                "type": "_source",
                "esTypes": [
                    "_source"
                ],
                "scripted": false,
                "searchable": false,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "_type",
                "type": "string",
                "scripted": false,
                "searchable": false,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "app",
                "type": "unknown",
                "esTypes": [
                    "flat_object"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "broker",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "containermetric.cpu_percentage",
                "type": "number",
                "esTypes": [
                    "half_float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "containermetric.disk_bytes",
                "type": "number",
                "esTypes": [
                    "long"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "containermetric.disk_bytes_quota",
                "type": "number",
                "esTypes": [
                    "long"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "containermetric.memory_bytes",
                "type": "number",
                "esTypes": [
                    "long"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "containermetric.memory_bytes_quota",
                "type": "number",
                "esTypes": [
                    "long"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "containermetric.name",
                "type": "string",
                "esTypes": [
                    "text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "containermetric.unit",
                "type": "string",
                "esTypes": [
                    "text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "containermetric.value",
                "type": "string",
                "esTypes": [
                    "text"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "created at",
                "type": "date",
                "esTypes": [
                    "date"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "geoip.location",
                "type": "geo_point",
                "esTypes": [
                    "geo_point"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "message",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.average",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.count",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.db_size",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.db_instance_identifier",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.domain_name",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.max",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.min",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.node_id",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.storage_type",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.sum",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.unit",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric.usage_percentage",
                "type": "number",
                "esTypes": [
                    "float"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metric_name",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "metrics_sd_params",
                "type": "unknown",
                "esTypes": [
                    "flat_object"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "namespace",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "syslog_sd_params",
                "type": "unknown",
                "esTypes": [
                    "flat_object"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": false,
                "readFromDocValues": false
            },
            {
                "count": 0,
                "name": "tags",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            },
            {
                "count": 0,
                "name": "updated at",
                "type": "string",
                "esTypes": [
                    "keyword"
                ],
                "scripted": false,
                "searchable": true,
                "aggregatable": true,
                "readFromDocValues": true
            }
        ]
http_enabled = p('cloudfoundry.event_types').include? 'HttpStartStop'

if(http_enabled == true)
  fields_json.concat(
    [
    {"name":"httpstartstop.content_length","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.duration_in_ms","type":"number","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.forwarded","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.method","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.peer_type","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.remote_addr","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.request_id","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.start_timestamp","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.status_code","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.stop_timestamp","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.uri","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true},
    {"name":"httpstartstop.user_agent","type":"string","count":0,"scripted":false,"indexed":true,"analyzed":false,"doc_values":true,"searchable":true,"aggregatable":true}
    ]
  )
end
%>

{
    "attributes": {
        "title": "logs-metrics-*",
        "timeFieldName": "@timestamp",
        "fields": "<%= fields_json.to_json.gsub(/\\/, '\\\\').gsub(/"/, '\"') %>"
    },
    "id": "logs-metrics-*",
    "title": "logs-metrics-*",
    "type": "index-pattern"
}